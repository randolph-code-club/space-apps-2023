<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" 
		content="width=device-width, 
		initial-scale=1.0, 
		user-scalable=no" />
  <title>Drag/Drop/Bounce</title>
  <style>
	#container {
	  width: 100%;
	  height: 400px;
	  background-color: #333;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  overflow: hidden;
	  border-radius: 7px;
	  touch-action: none;
	}
	#earth {
	  width: 200px;
	  height: 200px;
	  background-color: rgb(40, 156, 213);
	  border: 10px solid rgba(136, 136, 136, .5);
	  border-radius: 50%;
	  touch-action: none;
	  user-select: none;
	  position: absolute;
	  right: 10px;
	  top: 100px;
	}
	#sun {
	  width: 375px;
	  height: 375px;
	  background-color: rgb(245, 230, 99);
	  border: 10px solid rgba(136, 136, 136, .5);
	  border-radius: 50%;
	  touch-action: none;
	  user-select: none;
	  position: absolute;
	  left: 10px;
	  top: 10px;
	}
	#item {
	  width: 100px;
	  height: 100px;
	  background-color: rgb(123, 132, 137);
	  border: 10px solid rgba(136, 136, 136, .5);
	  border-radius: 50%;
	  touch-action: none;
	  user-select: none;
	}
	#item:active {
	  background-color: rgba(168, 218, 220, 1.00);
	}
	#item:hover {
	  cursor: pointer;
	  border-width: 20px;
	}


	#eclipse {
	  width: 400px;
	  height: 400px;
	  background-color: #333;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  overflow: hidden;
	  border-radius: 7px;
	  touch-action: none;
	}

	#eclipse-sun {
	  width: 300px;
	  height: 300px;
	  background-color: rgb(245, 230, 99);
	  border: 10px solid rgba(136, 136, 136, .5);
	  border-radius: 50%;
	  touch-action: none;
	  user-select: none;
	}
	#eclipse-moon {
	  width: 200px;
	  height: 200px;
	  background-color: rgb(123, 132, 137);
	  border: 10px solid rgba(136, 136, 136, .5);
	  border-radius: 50%;
	  touch-action: none;
	  user-select: none;
	  position: absolute;
	}
  </style>
</head>

<body>

  <div id="outerContainer">
	<div id="container">
	  <div id="earth">

	  </div>
	  <div id="sun">

	  </div>
	  <div id="item">

	  </div>
	</div>
  </div>
  <br/>
  <div id="eclipse-outer">
	<div id="eclipse">
		<div id="eclipse-sun">
  
		</div>
		<div id="eclipse-moon">
  
		</div>
	</div>
  </div>

  <script>
	// document.addEventListener("DOMContentLoaded", setSize());
	window.onload = function() {
		setSize();
	}

	var dragItem = document.querySelector("#item");
	var container = document.querySelector("#container");
	var eclipseMoon = document.querySelector("#eclipse-moon");
	var fixedEarth = document.querySelector("#earth");
	var fixedSun = document.querySelector("#sun");
	var eclipseSun = document.querySelector("#eclipse-sun");
	var fixedEarthLeft = fixedEarth.getBoundingClientRect().left
	var fixedRight = fixedSun.getBoundingClientRect().left
	var minMoon = 1
	var maxMoon = 400
	var eclipseMoonCenter = eclipseMoon.getBoundingClientRect().top
	var eclipseMoonX = eclipseMoon.getBoundingClientRect().left
	var dragItemCenter = dragItem.getBoundingClientRect().top

	var active = false;
	var currentX;
	var currentY;
	var initialX;
	var initialY;
	var xOffset = 0;
	var yOffset = 0;

	container.addEventListener("touchstart", dragStart, false);
	container.addEventListener("touchend", dragEnd, false);
	container.addEventListener("touchmove", drag, false);

	container.addEventListener("mousedown", dragStart, false);
	container.addEventListener("mouseup", dragEnd, false);
	container.addEventListener("mousemove", drag, false);

	function dragStart(e) {
	  if (e.type === "touchstart") {
		initialX = e.touches[0].clientX - xOffset;
		initialY = e.touches[0].clientY - yOffset;
	  } else {
		initialX = e.clientX - xOffset;
		initialY = e.clientY - yOffset;
	  }

	  if (e.target === dragItem) {
		active = true;
	  }
	}

	function dragEnd(e) {
	  initialX = currentX;
	  initialY = currentY;

	  active = false;
	}

	function drag(e) {
	  if (active) {
	  
		e.preventDefault();
	  
		if (e.type === "touchmove") {
		  currentX = e.touches[0].clientX - initialX;
		  currentY = e.touches[0].clientY - initialY;
		} else {
		  currentX = e.clientX - initialX;
		  currentY = e.clientY - initialY;
		}

		xOffset = currentX;
		yOffset = currentY;

		setTranslate(currentX, currentY, dragItem);
		setSize()
	  }
	}

	function setTranslate(xPos, yPos, el) {
	  el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
	}
	function setSize() {
		var newX = dragItem.getBoundingClientRect().left
		var factor = fixedEarthLeft / maxMoon;
		var moonSize = newX / factor
		eclipseMoon.style.width = moonSize.toString() + "px";
		eclipseMoon.style.height = moonSize.toString() + "px";

		var newY = dragItem.getBoundingClientRect().top
		console.log("eclipseMoonCenter: " + eclipseMoonCenter)
		console.log("fixedRight: " + fixedRight)
		console.log("newX: " + newX)
		console.log("moonSize: " + moonSize)
		console.log("factor: " + factor)
		console.log("------")

		eclipseMoon.style.transform = "translate3d(" + 0 + "px, " + ((dragItemCenter - newY) * -1) + "px, 0)";
	}
  </script>
</body>

</html>